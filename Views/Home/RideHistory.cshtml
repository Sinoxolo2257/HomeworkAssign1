@{
    ViewBag.Title = "RideHistory";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <style>
        .history-wrapper {
            margin-top: 40px;
        }

        .table-responsive {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            overflow: hidden;
        }

        .table th {
            background-color: #343a40;
            color: white;
            font-weight: bold;
        }

        .table td, .table th {
            vertical-align: middle;
            text-align: center;
        }

        .sos-row {
            background-color: #fff5f5 !important;
            border-left: 5px solid red;
        }

        tr:hover {
            background-color: #f1f1f1;
            cursor: pointer;
        }
    </style>
}

<div class="container history-wrapper">
    <h2 class="text-center mb-4">Ride History</h2>

    <div class="table-responsive">
        <table class="table table-bordered table-striped" id="rideHistoryTable">
            <thead>
                <tr>
                    <th>Pick-Up Date & Time</th>
                    <th>Booking ID</th>
                    <th>Driver</th>
                    <th>Service Type</th>
                    <th>Pick-Up Address</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            const bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
            const drivers = JSON.parse(localStorage.getItem("drivers") || "[]");

            if (bookings.length === 0) {
                $('#rideHistoryTable tbody').html(
                    '<tr><td colspan="5" class="text-danger">No ride history available.</td></tr>');
                return;
            }

            bookings.forEach(booking => {
                const driver = drivers.find(d => d.DriverID === booking.DriverID);
                const driverName = driver ? `${driver.FirstName} ${driver.LastName}` : "Unknown";

                const rowClass = booking.IsSOS ? "sos-row" : "";

                const row = `<tr class="${rowClass}" onclick="window.location.href='/Home/ConfirmBooking?bookingId=${booking.BookingID}'">
                        <td>${new Date(booking.PickupDateTime).toLocaleString()}</td>
                        <td>${booking.BookingID}</td>
                        <td>${driverName}</td>
                        <td>${booking.ServiceType}</td>
                        <td>${booking.Address}</td>
                    </tr>`;

                $('#rideHistoryTable tbody').append(row);
            });
        });
    </script>
}
