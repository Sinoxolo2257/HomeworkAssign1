@{
    ViewBag.Title = "ConfirmBooking";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <style>
        .confirmation-card {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 40px;
        }

            .confirmation-card h2 {
                font-size: 1.5em;
                margin-bottom: 20px;
            }

        .btn-back {
            background-color: #007bff;
            color: white;
            margin-top: 20px;
        }

            .btn-back:hover {
                background-color: #0056b3;
            }

        .sos-highlight {
            border-left: 5px solid red;
        }
    </style>
}

<div class="container">
    <div id="bookingDetails" class="confirmation-card"></div>
    <a href="@Url.Action("HomePage", "Home")" class="btn btn-back">← Back to Home</a>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            const params = new URLSearchParams(window.location.search);
            const bookingId = params.get('bookingId');

            if (!bookingId) {
                $('#bookingDetails').html('<p class="text-danger">Booking ID is missing. Please try again.</p>');
                return;
            }

            const bookings = JSON.parse(localStorage.getItem('bookings') || "[]");
            const booking = bookings.find(b => b.bookingId === bookingId);

            if (!booking) {
                $('#bookingDetails').html('<p class="text-danger">Booking not found. Please try again.</p>');
                return;
            }

            const drivers = JSON.parse(localStorage.getItem("drivers") || "[]");
            const vehicles = JSON.parse(localStorage.getItem("vehicles") || "[]");

            const driver = drivers.find(d => d.id === booking.driverId);
            const vehicle = vehicles.find(v => v.id === booking.vehicleId);

            const driverName = driver ? `${driver.FirstName} ${driver.LastName}` : "Unknown";
            const licensePlate = vehicle ? vehicle.LicensePlate : "Unknown";

            const cardClass = booking.isSOS ? "confirmation-card sos-highlight" : "confirmation-card";

            const detailsHtml = `
                    <div class="${cardClass}">
                        <h2>Booking Confirmation</h2>
                        <p><strong>Booking ID:</strong> ${booking.bookingId}</p>
                        <p><strong>Date:</strong> ${new Date(booking.bookingDate).toLocaleString()}</p>
                        <p><strong>Service Type:</strong> ${booking.serviceType}</p>
                        <p><strong>Full Name:</strong> ${booking.fullName}</p>
                        <p><strong>Contact Number:</strong> ${booking.contactNumber}</p>
                        <p><strong>Pick-Up Date and Time:</strong> ${booking.pickupDateTime}</p>
                        <p><strong>Pick-Up Address:</strong> ${booking.address}</p>
                        <p><strong>Reason:</strong> ${booking.reason}</p>
                        <p><strong>Driver:</strong> ${driverName}</p>
                        <p><strong>Vehicle:</strong> ${licensePlate}</p>
                        <p><strong>Booking Type:</strong> ${booking.isSOS ? "🚨 S.O.S" : "Standard"}</p>
                    </div>
                `;

            $('#bookingDetails').html(detailsHtml);
        });
    </script>
}
