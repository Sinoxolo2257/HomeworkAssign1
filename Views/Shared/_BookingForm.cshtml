@model string

@{
    string serviceType = Model;
    ViewBag.Title = "Book Ambulance";
}

@section Styles {
    <style>
        .booking-background {
           background-image: url('@Url.Content("~/images/ambulance_background.jpg")');
           background-size: cover;
           background-position: center;
           background-repeat: no-repeat;
           position: relative;
           min-height: 100vh;
        }


            .booking-background::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.4);
                z-index: 0;
            }

        .form-wrapper {
            position: relative;
            z-index: 1;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        label {
            font-weight: 500;
            color: #fff;
        }

        .form-control, .form-select, textarea {
            background-color: rgba(255,255,255,0.9);
            border: none;
            color: #000;
        }

        .btn-submit {
            background-color: #28a745;
            color: white;
            font-weight: bold;
        }

            .btn-submit:hover {
                background-color: #218838;
            }
    </style>
}

<div class="booking-background d-flex justify-content-center align-items-center">
    <div class="form-wrapper w-100" style="max-width: 700px;">
        <form id="bookingForm">
            <input type="hidden" id="serviceType" value="@serviceType" />

            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">Full Name*</label>
                    <input type="text" class="form-control" id="fullName" placeholder="Enter your full name" required>
                </div>
                <div class="col-md-6">
                    <label for="contactNumber">Phone Number*</label>
                    <input type="tel" class="form-control" id="contactNumber" placeholder="Enter your phone number" required>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Pick-Up Date and Time*</label>
                    <input type="datetime-local" class="form-control" id="pickupDateTime" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Reason*</label>
                    <select id="reasonSelect" class="form-control" required>
                        <option value="" disabled selected>Select reason for service</option>
                        <option>Accident</option>
                        <option>Patient Transfer</option>
                        <option>Utility Transport</option>
                        <option>Event Standby</option>
                        <option>Air Evacuation</option>
                    </select>
                </div>

                <div class="col-md-6">
                    <label for="vehicleId">Vehicle*</label>
                    <select id="vehicleId" class="form-control" required></select>
                </div>
                <div class="col-md-6">
                    <label for="driverId">Driver*</label>
                    <select id="driverId" class="form-control" required></select>
                </div>

                <div class="col-12">
                    <label class="form-label">Pick-Up Address*</label>
                    <textarea id="pickupAddress" class="form-control" rows="3" placeholder="Enter pick-up address" required></textarea>
                </div>
            </div>

            <button type="submit" class="btn btn-submit w-100 mt-4">Book Ambulance</button>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Get the service type from hidden input
            const serviceType = $('#serviceType').val();

            // Load data from localStorage
            const drivers = JSON.parse(localStorage.getItem("drivers") || "[]");
            const vehicles = JSON.parse(localStorage.getItem("vehicles") || "[]");

            // Populate vehicles dropdown
            vehicles
                .filter(v => v.serviceType === serviceType)
                .forEach(v => {
                    $('#vehicleId').append(`<option value="${v.id}">${v.licensePlate}</option>`);
                });

            // Populate drivers dropdown
            drivers
                .filter(d => d.serviceType === serviceType)
                .forEach(d => {
                    const name = `${d.firstName} ${d.lastName}`;
                    $('#driverId').append(`<option value="${d.id}">${name}</option>`);
                });

            // Handle form submission
            $('#bookingForm').on('submit', function (e) {
                e.preventDefault();

                const booking = {
                    bookingId: crypto.randomUUID(),
                    bookingDate: new Date().toISOString(),
                    fullName: $('#fullName').val(),
                    contactNumber: $('#contactNumber').val(),
                    pickupDateTime: $('#pickupDateTime').val(),
                    reason: $('#reasonSelect').val(),
                    driverId: $('#driverId').val(),
                    vehicleId: $('#vehicleId').val(),
                    serviceType: serviceType,
                    address: $('#pickupAddress').val(),
                    isSOS: false
                };


                const bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
                bookings.push(booking);
                localStorage.setItem("bookings", JSON.stringify(bookings));

                // Redirect to confirmation screen
                window.location.href = `/Home/ConfirmBooking?bookingId=${booking.BookingID}`;
            });
        });
    </script>
}

